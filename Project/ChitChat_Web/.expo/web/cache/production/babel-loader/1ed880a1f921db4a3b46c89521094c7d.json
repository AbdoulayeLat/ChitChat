{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;})),keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){_defineProperty(target,key,source[key]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}return target;}import _regeneratorRuntime from\"@babel/runtime/regenerator\";import React,{useCallback,useState,useLayoutEffect}from'react';import View from\"react-native-web/dist/exports/View\";import Text from\"react-native-web/dist/exports/Text\";import StyleSheet from\"react-native-web/dist/exports/StyleSheet\";import TouchableOpacity from\"react-native-web/dist/exports/TouchableOpacity\";import Image from\"react-native-web/dist/exports/Image\";import{auth,firestore,storage}from\"../../firebase\";import{signOut}from'firebase/auth';import{collection,addDoc,doc,setDoc,getDoc,query,orderBy,onSnapshot,where}from'firebase/firestore';import{ref,getDownloadURL}from'@firebase/storage';import{GiftedChat,InputToolbar}from'react-native-gifted-chat';import Colors from\"../../utils/Colors\";import{useEffect}from'react';import{jsx as _jsx}from\"react/jsx-runtime\";var ChatScreen=function ChatScreen(_ref){var _auth$currentUser;var route=_ref.route,navigation=_ref.navigation;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),messages=_useState2[0],setMessages=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),friendName=_useState4[0],setFriendName=_useState4[1];var token=auth.currentUser.uid;var _React$useState=React.useState(),_React$useState2=_slicedToArray(_React$useState,2),imageURL=_React$useState2[0],setImageURL=_React$useState2[1];var phoneNumber=auth.currentUser.phoneNumber;var friendPhoneNumber=route.params.friendPhoneNumber;var _React$useState3=React.useState(),_React$useState4=_slicedToArray(_React$useState3,2),friendUID=_React$useState4[0],setFrienUID=_React$useState4[1];var storageRef=ref(storage,'images/ProfilePictures/'+token);var signOutNow=function signOutNow(){signOut(auth).then(function(){navigation.replace('Home');}).catch(function(error){});};getDownloadURL(storageRef).then(function(url){setImageURL(url);}).catch(function(error){console.log(error);});useLayoutEffect(function(){navigation.setOptions({headerRight:function headerRight(){return _jsx(TouchableOpacity,{style:{marginRight:10},onPress:signOutNow,children:_jsx(Text,{style:{color:'white',fontWeight:'bold',fontSize:18},children:\"Logout\"})});},title:friendPhoneNumber,headerStyle:{backgroundColor:Colors.Primary}});},[navigation]);useEffect(function(){var q=query(collection(firestore,'chats/'+phoneNumber+\"/\"+friendPhoneNumber.toString()),orderBy('createdAt','desc'));var unsubscribe=onSnapshot(q,function(snapshot){return setMessages(snapshot.docs.map(function(doc){return{_id:doc.data()._id,createdAt:doc.data().createdAt.toDate(),text:doc.data().text,user:doc.data().user};}));});return function(){unsubscribe();};});var _onSend=useCallback(function _callee(){var messages,phoneNumber,friendName,friendPhoneNumber,_messages$,_id,createdAt,text,user,_args=arguments;return _regeneratorRuntime.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:messages=_args.length>0&&_args[0]!==undefined?_args[0]:[];phoneNumber=_args.length>1?_args[1]:undefined;friendName=_args.length>2?_args[2]:undefined;friendPhoneNumber=_args.length>3?_args[3]:undefined;_messages$=messages[0],_id=_messages$._id,createdAt=_messages$.createdAt,text=_messages$.text,user=_messages$.user;_context.next=7;return _regeneratorRuntime.awrap(setDoc(doc(firestore,'chats/'+phoneNumber),{uid:auth.currentUser.uid,contacts:[{friendName:friendName,friendPhoneNumber:friendPhoneNumber}]}));case 7:addDoc(collection(firestore,'chats/'+phoneNumber+\"/\"+friendPhoneNumber),{_id:_id,createdAt:createdAt,text:text,user:user});addDoc(collection(firestore,'chats/'+friendPhoneNumber+\"/\"+phoneNumber),{_id:_id,createdAt:createdAt,text:text,user:user});case 9:case\"end\":return _context.stop();}}},null,null,null,Promise);},[]);var customtInputToolbar=function customtInputToolbar(props){return _jsx(InputToolbar,_objectSpread(_objectSpread({},props),{},{containerStyle:{borderRadius:10,marginHorizontal:5,justifyContent:'center'}}));};return _jsx(View,{style:styles1.view,children:_jsx(GiftedChat,{messages:messages,showAvatarForEveryMessage:true,onSend:function onSend(messages){return _onSend(messages,phoneNumber,friendName,friendPhoneNumber);},isLoadingEarlier:true,showUserAvatar:true,placeholder:\"Chat Away...\",renderInputToolbar:function renderInputToolbar(props){return customtInputToolbar(props);},user:{_id:auth==null?void 0:(_auth$currentUser=auth.currentUser)==null?void 0:_auth$currentUser.uid,avatar:imageURL}})});};var styles1=StyleSheet.create({view:{backgroundColor:Colors.Primary,flex:1}});export default ChatScreen;","map":{"version":3,"sources":["/Users/abdoulayendiaye/Documents/chitchat/screens/Chat/ChatScreen.js"],"names":["React","useCallback","useState","useLayoutEffect","auth","firestore","storage","signOut","collection","addDoc","doc","setDoc","getDoc","query","orderBy","onSnapshot","where","ref","getDownloadURL","GiftedChat","InputToolbar","Colors","useEffect","ChatScreen","route","navigation","messages","setMessages","friendName","setFriendName","token","currentUser","uid","imageURL","setImageURL","phoneNumber","friendPhoneNumber","params","friendUID","setFrienUID","storageRef","signOutNow","then","replace","catch","error","url","console","log","setOptions","headerRight","marginRight","color","fontWeight","fontSize","title","headerStyle","backgroundColor","Primary","q","toString","unsubscribe","snapshot","docs","map","_id","data","createdAt","toDate","text","user","onSend","contacts","customtInputToolbar","props","borderRadius","marginHorizontal","justifyContent","styles1","view","avatar","StyleSheet","create","flex"],"mappings":"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","sourcesContent":["import React, { useCallback, useState, useLayoutEffect } from 'react';\nimport { View, Text, StyleSheet, TouchableOpacity, Image } from 'react-native';\nimport { auth, firestore, storage } from '../../firebase';\nimport { signOut } from 'firebase/auth';\nimport { collection, addDoc, doc, setDoc, getDoc, query, orderBy, onSnapshot, where } from 'firebase/firestore';\nimport { ref, getDownloadURL } from '@firebase/storage';\nimport { GiftedChat, InputToolbar } from 'react-native-gifted-chat';\nimport Colors from '../../utils/Colors';\nimport { useEffect } from 'react';\n\nconst ChatScreen = ({ route, navigation }) => {\n    const [messages, setMessages] = useState([]);\n    const [friendName, setFriendName] = useState();\n    const token = auth.currentUser.uid;\n    const [imageURL, setImageURL] = React.useState();\n    const phoneNumber = auth.currentUser.phoneNumber;\n    const friendPhoneNumber = route.params.friendPhoneNumber;\n    const [friendUID, setFrienUID] = React.useState();\n    const storageRef = ref(storage, 'images/ProfilePictures/'+token);\n\n    const signOutNow = () => {\n      signOut(auth).then(() => {\n          // Sign-out successful.\n          navigation.replace('Home');\n      }).catch((error) => {\n          // An error happened.\n      });\n    }\n\n    getDownloadURL(storageRef)\n    .then((url) => {\n      setImageURL(url)\n    })\n    .catch((error) => {\n      console.log(error)\n    });\n    \n    useLayoutEffect(() => {\n        navigation.setOptions({\n          headerRight: () => (\n            <TouchableOpacity style={{\n                marginRight: 10\n            }}\n                onPress={signOutNow}\n            >\n                <Text style={{color: 'white', fontWeight:'bold', fontSize:18}}>Logout</Text>\n            </TouchableOpacity>\n          ),\n          title: friendPhoneNumber,\n          headerStyle:{\n            backgroundColor: Colors.Primary,\n          }\n        })\n    }, [navigation]);\n      \n    useEffect(() => {\n      const q = query(collection(firestore, 'chats/'+phoneNumber+\"/\"+friendPhoneNumber.toString()), orderBy('createdAt', 'desc'));\n      const unsubscribe = onSnapshot(q, (snapshot) => setMessages(\n          snapshot.docs.map(doc => ({\n              _id: doc.data()._id,\n              createdAt: doc.data().createdAt.toDate(),\n              text: doc.data().text,\n              user: doc.data().user,\n          }))\n      ));\n      return () => {\n        unsubscribe();\n      };\n    })\n\n    const onSend = useCallback(async (messages = [], phoneNumber, friendName, friendPhoneNumber) => {\n        const { _id, createdAt, text, user} = messages[0]\n        await setDoc(doc(firestore, 'chats/'+phoneNumber), {\n          uid: auth.currentUser.uid,\n          contacts: [{friendName, friendPhoneNumber}]\n        });\n        addDoc(collection(firestore, 'chats/'+phoneNumber+\"/\"+friendPhoneNumber), { _id, createdAt,  text, user });\n        addDoc(collection(firestore, 'chats/'+friendPhoneNumber+\"/\"+phoneNumber), { _id, createdAt,  text, user });\n    }, []);\n\n  const customtInputToolbar = props => {\n    return (\n      <InputToolbar\n        {...props}\n        containerStyle={{\n          borderRadius: 10,\n          marginHorizontal: 5,\n          justifyContent: 'center',\n        }}\n      />\n    );\n  };\n  \n\n  return (\n    <View style={styles1.view}>\n      <GiftedChat\n          messages={messages}\n          showAvatarForEveryMessage={true}\n          onSend={messages => onSend(messages, phoneNumber, friendName, friendPhoneNumber)}\n          isLoadingEarlier={true}\n          showUserAvatar={true}\n          placeholder={\"Chat Away...\"}\n          renderInputToolbar={props => customtInputToolbar(props)}\n          user={{\n              _id: auth?.currentUser?.uid,\n              avatar: imageURL\n          }}\n      />\n    </View>\n  );\n}\n\nconst styles1 = StyleSheet.create({\n  view:{\n    backgroundColor: Colors.Primary,\n    flex:1\n  }\n});\n\nexport default ChatScreen"]},"metadata":{},"sourceType":"module"}